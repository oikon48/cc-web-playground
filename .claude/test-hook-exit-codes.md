# ccusage Hook Exit Code Test Results

## テスト方法
1. `.claude/stop-hook-ccusage.sh`の最後に`exit 1`または`exit 2`を追加
2. 会話を終了する
3. 表示されるメッセージや動作を観察

## 予想される動作

### exit 0 (正常終了)
- hookは正常に実行される
- ccusageの統計が表示される
- エラーメッセージなし

### exit 1 (一般的なエラー)
- hookがエラーで終了
- 可能性1: エラーメッセージが表示されるが会話は終了する
- 可能性2: エラーは無視され、会話は通常通り終了する
- 可能性3: ユーザーにhookの失敗が通知される

### exit 2 (誤用エラー)
- exit 1と同様の動作が予想される
- シェルスクリプトの慣習では、exit 2は「誤用」を示すことが多い

## 実際のテスト結果

### exit 1の場合

**テスト日時**: 2025-10-30

**観察された動作**:
1. Stop hookは実行された（git-check hookからのフィードバックを受信）
2. ccusage hookの出力（統計情報）は**表示されなかった**
3. git-check hookは正常に実行され、フィードバックが表示された
4. 会話は正常に終了できた（exit 1で会話終了がブロックされることはない）

**結論**:
- `exit 1`で終了したhookの出力は抑制される可能性が高い
- 他のhookの実行には影響しない（git-check hookは正常に動作）
- Stop hookの失敗は会話終了をブロックしない

**推測される仕様**:
- Stop hookのexit codeが0以外の場合、そのhookの出力は表示されない
- 複数のhookがある場合、各hookは独立して実行される
- hookの失敗はユーザーに直接通知されない（出力が表示されないことで間接的に分かる）

### exit 2の場合
(会話終了後にここに記録)

## 注意点
- `set -euo pipefail`が設定されているため、スクリプト内でエラーが発生すると自動的に終了する
- 明示的に`exit 1`を追加した場合の動作を確認する
